- form_for @user, :html => { :id => 'user' } do |f|
  -if @user.errors.any?
    #error_explanation
      %h2= "#{pluralize(@user.errors.count, "error")} prohibited this user from being saved:"
      %ul
        - @user.errors.full_messages.each do |msg|
          %li= msg
  - @supervisorEmployeesTemplate = generate_nested_attributes_template(f, :supervisor_employees, 'staff/supervisor_employees')
  = hidden_field_tag "return_path", "users_staff_index_path"
  = f.hidden_field :validate_update, :value => false
  .block
    .title
      General Information
    .row
      = f.label :first_name
      = f.text_field :first_name
    .row
      = f.label :last_name
      = f.text_field :last_name
    .row
      = f.label :email
      = f.text_field :email
    .row
      = f.label :username, NcsNavigator.configuration.study_center_username
      = f.text_field :username
    .row
      = f.label :formatted_ncs_inactive_date, "Inactive Date"
      = f.text_field :formatted_ncs_inactive_date, {:class => "datepicker", :size =>10, :maxlength =>10, :id => "pickdate"} 
      = label_tag "(Leave blank to have it never expire, or set it in the past to have it expire immediately.)"
    = f.hidden_field :study_center, :value => StaffPortal.study_center_id
  .block
    .title
      Role Information
    .row
      - Role.all.each do |r|
        .field
          = check_box_tag "staff[role_ids][]",r.id, @user.roles.map(&:id).include?(r.id)
          = r.name
        
  - if @user.has_role(Role::STAFF_SUPERVISOR)
    .block
      .title
        Supervising Staff Information
      %table{ :class => 'records supervisor_employees row' }
        %tr.row
          %td
            Supervising all the staff
            %em * 
            (Click the 'Add staff member' link to add more staff members to supervise)
        %tbody.nested_records_supervisor_employees
          - f.fields_for :supervisor_employees do |supervisor_employee|
            = render :partial => 'staff/supervisor_employees', :locals => { :f => supervisor_employee }
        %tfoot
          %tr.row
            %td{ :colspan => '3' }
              = link_to_add_fields "Add staff member", :supervisor_employees
  - else
    = "Current staff will be supervise by"
    = display_supervisors(Staff.default_supervisors).html_safe
    = ". If you want to add particular supervisor for the staff, please go the supervisor page and add staff under supervisor."
  .actions
    = f.submit 'Save', :class => "control_button"
    
  :javascript
    $(".datepicker").datepicker();
    $(document).ready(function() {
      supervisorEmployeesTemplateUI = new NCSPortal.SupervisorEmployees.UI({supervisorEmployeesTemplate: '#{@supervisorEmployeesTemplate}' });
    })